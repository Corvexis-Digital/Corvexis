import{j as e,L as R,a as O,s as v,p as G,u as T,b as H,c as E,d as K,e as F,f as V,m as J,g as X,o as Z,h as _,i as W,k as Y}from"./index-DcyBRlfo.js";import{r as d}from"./vendor-lottie-BKil9D5R.js";import{U as ee,T as se}from"./Toast-DpFMzWfU.js";const te="sk-f0eb31df7949493cab154002913a9183",ae="deepseek-chat";async function I(s){var r,w,x;const l=await(await fetch("https://api.deepseek.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${te}`},body:JSON.stringify({model:ae,messages:[{role:"user",content:s}],temperature:.2})})).json();return((x=(w=(r=l==null?void 0:l.choices)==null?void 0:r[0])==null?void 0:w.message)==null?void 0:x.content)||""}async function B(s){return(await I(`Summarize into 5-8 concise academic bullet points:

${s}`)).split(/\n+/).map(l=>l.replace(/^[-•]\s?/,"")).filter(Boolean)}async function L(s){const n=await I(`Classify and return JSON with keys subject, moduleCode(optional), keywords(array of 6-10 terms), title(short). Only output JSON.

${s}`),l=n.indexOf("{"),m=n.lastIndexOf("}"),r=l>=0?n.slice(l,m+1):"{}";return JSON.parse(r)}async function Q(s){const n=await I(`Extract modules/course entries as JSON array with keys code, title, credits(integer, 0 if unknown). Only output JSON.

${s}`),l=n.indexOf("["),m=n.lastIndexOf("]"),r=l>=0?n.slice(l,m+1):"[]";return JSON.parse(r)}function ie({children:s,onClick:n,className:l,disabled:m}){const[r,w]=d.useState(!1);async function x(){if(!m){w(!0);try{await(n==null?void 0:n())}finally{setTimeout(()=>w(!1),300)}}}return e.jsxs("button",{className:`relative overflow-hidden transition-transform ${r?"scale-95":""} ${l}`,onClick:x,disabled:m,children:[e.jsx("span",{className:`btn-ripple ${r?"animate-ripple":""}`}),s]})}function ce(){var U;const[s,n]=d.useState(null),[l,m]=d.useState([]),[r,w]=d.useState([]),[x,N]=d.useState(""),[q,z]=d.useState(!1),[A,S]=d.useState(""),[y,$]=d.useState(null),[C,P]=d.useState([]),[k,M]=d.useState([]),[b,g]=d.useState({show:!1,message:"",type:"info"});return d.useEffect(()=>{(async()=>{var o;if(s){z(!0),N("");try{const a=((o=O.currentUser)==null?void 0:o.uid)||"",u=!0,j=!0,D=!0;if(/spreadsheetml|ms-excel/.test(s.type)){const i=await G(s);if(P(i),D)try{if(a){const{url:h}=await T(a,s,"schedules");S(h)}}catch{}g({show:!0,message:`Parsed ${i.length} assignments`,type:"success"})}else if(/^text\//.test(s.type)){const i=await s.text(),h=u?await H(i):j?await B(i):await E(i),c=u?await K(i):j?await L(i):await F(i);m(h),$(c);try{const f=u?await V(i):j?await Q(i):await J(i);M(f),g({show:!0,message:`Detected ${f.length} modules`,type:"success"})}catch{}let p="";if(D&&a)try{p=(await T(a,s,"docs")).url,S(p)}catch{}a&&await v("materials",{userId:a,subject:c.moduleCode||c.subject||"general",title:c.title||s.name,url:p,moduleCode:c.moduleCode,keywords:c.keywords||[],description:h.join(`
`)})}else{let i="";u||(i=s.type.includes("pdf")?await X(s):await Z(s));const h=u?await _(s):j?await B(i):await E(i),c=u?await W(s):j?await L(i):await F(i);m(h),$(c);try{const f=u?await Y(s):j?await Q(i):await J(i);M(f),g({show:!0,message:`Detected ${f.length} modules`,type:"success"})}catch{}let p="";if(D&&a)try{p=(await T(a,s,"docs")).url,S(p)}catch{}a&&await v("materials",{userId:a,subject:c.moduleCode||c.subject||"general",title:c.title||s.name,url:p,moduleCode:c.moduleCode,keywords:c.keywords||[],description:h.join(`
`)})}}catch(a){N(a.message),g({show:!0,message:a.message,type:"error"})}finally{z(!1)}}})()},[s]),e.jsxs(R,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx(ee,{onFile:n}),e.jsx("div",{className:"text-xs text-gray-500",children:"Auto-scan runs on upload; results appear below."}),q&&e.jsx("div",{className:"shimmer h-8 rounded-full"}),x&&e.jsx("div",{className:"text-red-600 text-sm",children:x}),A&&e.jsx("a",{href:A,target:"_blank",rel:"noreferrer",className:"text-sm text-gray-700 underline",children:"View uploaded file"}),!!C.length&&e.jsxs("div",{className:"rounded-3xl bg-white p-6 shadow-sm",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Detected Assignments (Excel)"}),e.jsx("div",{className:"space-y-3",children:C.map((t,o)=>e.jsxs("div",{className:"border rounded-3xl p-4",children:[e.jsx("div",{className:"text-sm text-gray-500",children:t.moduleCode}),e.jsx("div",{className:"font-medium",children:t.title}),e.jsxs("div",{className:"text-sm",children:["Due: ",t.dueDate]}),t.description&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:t.description})]},o))}),e.jsx("button",{className:"mt-4 px-4 py-2 rounded-full bg-black text-white",onClick:async()=>{var o;const t=(o=O.currentUser)==null?void 0:o.uid;if(!t){N("Sign in required");return}for(const a of C)await v("assignments",{userId:t,moduleCode:a.moduleCode,title:a.title,dueDate:a.dueDate,description:a.description});alert("Assignments saved")},children:"Save All"})]}),!!k.length&&e.jsxs("div",{className:"rounded-3xl bg-white p-6 shadow-sm",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Detected Modules"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:k.map((t,o)=>e.jsxs("div",{className:"rounded-3xl border p-5 hover:shadow",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold",children:t.code}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Credits ",t.credits]})]}),e.jsx("div",{className:"mt-1",children:t.title})]},o))}),e.jsx(ie,{className:"mt-4 px-4 py-2 rounded-full bg-gradient-to-r from-emerald-500 to-emerald-400 text-white",onClick:async()=>{var o;const t=(o=O.currentUser)==null?void 0:o.uid;if(!t){N("Sign in required");return}for(const a of k)await v("modules",{userId:t,code:a.code,title:a.title,credits:Number(a.credits)||0});alert("Modules saved")},children:"Save All"})]}),y&&e.jsxs("div",{className:"rounded-3xl bg-white p-6 shadow-sm",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Detected Context"}),e.jsxs("div",{className:"text-sm",children:["Subject: ",y.subject||"—"]}),y.moduleCode&&e.jsxs("div",{className:"text-sm",children:["Module: ",y.moduleCode]}),!!((U=y.keywords)!=null&&U.length)&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:y.keywords.map((t,o)=>e.jsx("span",{className:"px-2 py-1 rounded-full bg-gray-100 text-xs",children:t},o))})]}),!!l.length&&e.jsxs("div",{className:"rounded-3xl bg-white p-6 shadow-sm",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Summary"}),e.jsx("ul",{className:"list-disc pl-6 space-y-1",children:l.map((t,o)=>e.jsx("li",{children:t},o))})]}),!!r.length&&e.jsxs("div",{className:"rounded-3xl bg-white p-6 shadow-sm",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Quiz"}),e.jsx("div",{className:"space-y-4",children:r.map((t,o)=>e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.question}),e.jsx("ul",{className:"list-decimal pl-6 text-sm text-gray-700",children:t.options.map((a,u)=>e.jsx("li",{children:a},u))})]},o))})]})]}),e.jsx(se,{show:b.show,message:b.message,type:b.type,position:b.type==="error"?"top":"bottom",onClose:()=>g(t=>({...t,show:!1}))})]})}export{ce as default};
